<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CrossKnowledge - Code challenge</title>
</head>
<body>
  <script>

    // This will create elements for testing, don't change this code
    (() => {
      const MS_PER_MINUTE = 60000
      const NOW = new Date()
      let minutes = [0, 1, 30, 60, 6 * 60, 23 * 60, 24 * 60]
      let dates = []

      minutes.forEach((i) => dates.push(new Date(NOW - i * MS_PER_MINUTE)))

      dates.forEach((item) => {
        let el = document.createElement("div")
        el.innerHTML = "Started "

        let dt = document.createElement('span')
        dt.className = 'js-date-format'
        dt.innerHTML = item.toISOString()
        el.appendChild(dt)
        document.body.appendChild(el)
      })
    })();

    (() => {

        function ShowElapsedTime() {
            this.length;
            this.jsDateFormatList;
            this.currentDate;
            this.setItSelf();
            this.setElapsedTime();
        }

        ShowElapsedTime.prototype.setItSelf = function () {
            let self = this;
            self.jsDateFormatList = document.getElementsByClassName('js-date-format');
            self.length = self.jsDateFormatList.length - 1; // There is no needs to consider the last one

            for (var i = 0; i < self.length; i++) {
                let dateFormat = self.jsDateFormatList[i]; // set style none, it necessary to remain the date data to proceed the calc of elapsed time
                dateFormat.style.display = 'none';

                let elapsed = document.createElement('span');
                elapsed.className = 'js-date-elapsed';

                let parent = self.jsDateFormatList[i].parentElement;
                parent.appendChild(elapsed);
            }
        }
 
        ShowElapsedTime.prototype.setElapsedTime = function () {
            let self = this;
            let arrayType = []
            const ELAPSED_DATA = document.getElementsByClassName('js-date-elapsed');
            setInterval(function () {
                const NOW = new Date();
                for (let i = 0; i < self.length; i++) {
                    let diff = NOW.getTime() - new Date(self.jsDateFormatList[i].innerText).getTime();
                    ELAPSED_DATA[i].innerHTML = resultTimeElapsed(diff);
                }
            }, 1000)
        }

        // TODO:  refactoring is requieried - algoritm repeat 3 times
        function resultTimeElapsed(diff) {

            if (diff < 60000) {
                calc = Math.floor(diff / 1000);
                return calc == 1 ? calc.toString() + ' second' : calc.toString()  + ' seconds';
            }

            if (diff < 3600000) {
                calc = Math.floor(diff / 1000 / 60);
                return calc == 1 ? calc.toString() + '  minut' : calc.toString() + ' minuts';
            }

            calc = Math.floor(diff / 1000 / 60 / 60);
            return calc == 1 ? calc.toString()  + ' hour' : calc.toString() + ' hours';
        }

        new ShowElapsedTime();

    })();

  </script>
</body>
</html>
